# <h1 id="header-3">üìñDesign Bandgap References using 7nm FinFET</h3>

**Bandgap Reference Voltage**

- A Bandgap Reference Voltage (Vref) is a temperature-independent, stable DC voltage generated by a special analog circuit called a bandgap reference circuit. For silicon-based ICs, this reference voltage is typically around: ùëâref‚âà1.2V 
- The reason for 1.2v is the bandgap energy of silicon is approximately 1.12 eV at room temperature (~27 ¬∞C). By designing the circuit carefully, we generate a voltage proportional to this energy, giving us a nearly constant Vref across temperature, supply, and process variations.
- When we integrate a Self-Biased Current Mirror (SBCM), the circuit becomes more stable and self-regulating.

The following is the reference circuit: 

<img width="661" height="405" alt="image" src="https://github.com/user-attachments/assets/c3c94d39-6453-4d03-8efe-79f855414f3a" />

| Feature | Traditional Bandgap | Bandgap with SBCM     |
| :--------  | :----------- |:------------------- |	
| Bias current	| External	| Self-generated |
| Power efficiency	| Lower	| Higher |
| Startup mechanism	| Needs manual circuit |	Built-in startup |
| Process variation |	More sensitive	| Better compensated |
| Chip area |	Larger	| Can be optimized |

Almost every SoC, CPU, GPU, RFIC, and analog IC has at least one bandgap reference because:

- ADCs & DACs ‚Üí Need stable reference voltage.
- PLLs & clock generators ‚Üí Require precise voltage.
- Power management ‚Üí LDOs & regulators need it.
- Sensors ‚Üí Temperature, pressure, and optical sensors rely on it.


| Feature              | **CTAT**                                       | **PTAT**                                       |
| -------------------- | ---------------------------------------------- | ---------------------------------------------- |
| Full Form            | Complementary to Absolute Temperature          | Proportional to Absolute Temperature           |
| Temperature Behavior | Voltage **decreases** as temperature increases | Voltage **increases** as temperature increases |
| Nature               | Negative temperature coefficient               | Positive temperature coefficient               |
| Typical Example      | BJT base‚Äìemitter voltage (**VBE**)             | Thermal voltage (**VT = kT/q**), ŒîVBE          |
| Mathematical Trend   | VBE ‚âà ‚Äì2 mV/¬∞C                                 | VT ‚àù T                                         |
| Source               | Single BJT or diode                            | Two BJTs with different current densities      |
| Used In              | Bandgap references, temperature sensors        | Bandgap references, bias generators            |
| Role in Bandgap      | Provides **CTAT slope**                        | Provides **PTAT slope**                        |
| Alone Behavior       | Temperature dependent                          | Temperature dependent                          |
| Combined Effect      | CTAT + PTAT ‚Üí **Temperature-stable voltage**   | CTAT + PTAT ‚Üí **Temperature-stable voltage**   |

The key idea is to combine two opposing temperature effects:

Source Type of Voltage Temperature Behavior Base‚Äìemitter voltage (VBE) of a BJT CTAT (Complementary to Absolute Temperature) Decreases as temperature rises Thermal voltage (VT = kT/q) PTAT (Proportional to Absolute Temperature) Increases as temperature rises

By adding a scaled PTAT voltage to a CTAT voltage: VREF = VBE + kVT

The temperature dependencies cancel each other out, yielding an approximately constant voltage ‚âà 1.205 V (the silicon bandgap at 0 K).

**Quick Memory Trick**

CTAT ‚Üí Cold ‚Üë Voltage ‚Üë ‚Üí Hot ‚Üë Voltage ‚Üì

PTAT ‚Üí Cold ‚Üì Voltage ‚Üì ‚Üí Hot ‚Üë Voltage ‚Üë


Bandgap Reference Equation (Recall)


VBE ‚Üí CTAT

ŒîVBE ‚Üí PTAT

Choose K correctly ‚Üí flat VREF (~1.2 V)

Resistance value as per ASCII name = 532ohm 
<img width="1035" height="493" alt="image" src="https://github.com/user-attachments/assets/191bff19-ec4e-4242-a38e-a78f0a9bd968" />


Spice file for Bandgap circuit with Unqiue resistance value used for R2 resistor
```
** sch_path: /home/vsduser/Desktop/Bandgap-Reference-Circuit-with-SCMB-with-ASAP-7nm-PDK-/Bandgap.sch
**.subckt Bandgap
Xnfet1 net3 net1 net7 net10 asap_7nm_nfet l=7e-009 nfin=14
Xnfet2 net2 net1 net9 net11 asap_7nm_nfet l=7e-009 nfin=14
Xpfet1 net3 net2 VDD net12 asap_7nm_pfet l=7e-009 nfin=14
Xpfet2 net2 net2 VDD net13 asap_7nm_pfet l=7e-009 nfin=14
Xpfet3 Vref net2 VDD net14 asap_7nm_pfet l=7e-009 nfin=14
Xpfet4 net4 net2 VDD net15 asap_7nm_pfet l=7e-009 nfin=14
Xpfet5 net5 net2 net4 net16 asap_7nm_pfet l=7e-009 nfin=14
Xpfet6 net1 net2 net2 net17 asap_7nm_pfet l=7e-009 nfin=14
Xnfet3 net5 net5 net6 net18 asap_7nm_nfet l=7e-009 nfin=14
Xnfet4 net6 net6 GND net19 asap_7nm_nfet l=7e-009 nfin=14
Xnfet5 net7 net7 GND net20 asap_7nm_nfet l=7e-009 nfin=14
Xnfet6 net8 net8 GND GND asap_7nm_nfet l=7e-009 nfin=14
Xnfet7 net8 net8 GND GND asap_7nm_nfet l=7e-009 nfin=14
Xnfet8 net8 net8 GND GND asap_7nm_nfet l=7e-009 nfin=14
Xnfet9 net8 net8 GND GND asap_7nm_nfet l=7e-009 nfin=14
R1 net9 net8 33k ac=1k m=1
R2 Vref Vctat 532 ac=1k m=1
Xnfet10 Vctat Vctat GND net21 asap_7nm_nfet l=7e-009 nfin=14
V2 vdd GND 1.75

**** begin user architecture code


.dc temp -45 125 5
.control
run
plot v(Vref)
plot v(Vctat)
.endc


**** end user architecture code
**.ends
.GLOBAL GND
.GLOBAL VDD
**** begin user architecture code

.subckt asap_7nm_pfet S G D B l=7e-009 nfin=14
	npmos_finfet S G D B BSIMCMG_osdi_P l=7e-009 nfin=14
.ends asap_7nm_pfet

.model BSIMCMG_osdi_P BSIMCMG_va (
+ TYPE = 0

************************************************************
*                         general                          *
************************************************************
+version = 107             bulkmod = 1               igcmod  = 1               igbmod  = 0
+gidlmod = 1               iimod   = 0               geomod  = 1               rdsmod  = 0
+rgatemod= 0               rgeomod = 0               shmod   = 0               nqsmod  = 0
+coremod = 0               cgeomod = 0               capmod  = 0               tnom    = 25
+eot     = 1e-009          eotbox  = 1.4e-007        eotacc  = 3e-010          tfin    = 6.5e-009
+toxp    = 2.1e-009        nbody   = 1e+022          phig    = 4.9278          epsrox  = 3.9
+epsrsub = 11.9            easub   = 4.05            ni0sub  = 1.1e+016        bg0sub  = 1.17
+nc0sub  = 2.86e+025       nsd     = 2e+026          ngate   = 0               nseg    = 5
+l       = 2.1e-008        xl      = 1e-009          lint    = -2.5e-009       dlc     = 0
+dlbin   = 0               hfin    = 3.2e-008        deltaw  = 0               deltawcv= 0
+sdterm  = 0               epsrsp  = 3.9             nfin    = 1
+toxg    = 1.8e-009
************************************************************
*                            dc                            *
************************************************************
+cit     = 0               cdsc    = 0.003469        cdscd   = 0.001486        dvt0    = 0.05
+dvt1    = 0.36            phin    = 0.05            eta0    = 0.094           dsub    = 0.24
+k1rsce  = 0               lpe0    = 0               dvtshift= 0               qmfactor= 0
+etaqm   = 0.54            qm0     = 2.183e-012      pqm     = 0.66            u0      = 0.0237
+etamob  = 4               up      = 0               ua      = 1.133           eu      = 0.05
+ud      = 0.0105          ucs     = 0.2672          rdswmin = 0               rdsw    = 200
+wr      = 1               rswmin  = 0               rdwmin  = 0               rshs    = 0
+rshd    = 0               vsat    = 60000           deltavsat= 0.17            ksativ  = 1.592
+mexp    = 2.491           ptwg    = 25              pclm    = 0.01            pclmg   = 1
+pdibl1  = 800             pdibl2  = 0.005704        drout   = 4.97            pvag    = 200
+fpitch  = 2.7e-008        rth0    = 0.15            cth0    = 1.243e-006      wth0    = 2.6e-007
+lcdscd  = 0               lcdscdr = 0               lrdsw   = 1.3             lvsat   = 1441
************************************************************
*                         leakage                          *
************************************************************
+aigc    = 0.007           bigc    = 0.0015          cigc    = 1               dlcigs  = 5e-009
+dlcigd  = 5e-009          aigs    = 0.006           aigd    = 0.006           bigs    = 0.001944
+bigd    = 0.001944        cigs    = 1               cigd    = 1               poxedge = 1.152
+agidl   = 2e-012          agisl   = 2e-012          bgidl   = 1.5e+008        bgisl   = 1.5e+008
+egidl   = 1.142           egisl   = 1.142
************************************************************
*                            rf                            *
************************************************************
************************************************************
*                         junction                         *
************************************************************
************************************************************
*                       capacitance                        *
************************************************************
+cfs     = 0               cfd     = 0               cgso    = 1.6e-010        cgdo    = 1.6e-010
+cgsl    = 0               cgdl    = 0               ckappas = 0.6             ckappad = 0.6
+cgbo    = 0               cgbl    = 0
************************************************************
*                       temperature                        *
************************************************************
+tbgasub = 0.000473        tbgbsub = 636             kt1     = 0               kt1l    = 0
+ute     = -1.2            utl     = 0               ua1     = 0.001032        ud1     = 0
+ucste   = -0.004775       at      = 0.001           ptwgt   = 0.004           tmexp   = 0
+prt     = 0               tgidl   = -0.007          igt     = 2.5
************************************************************
*                          noise                           *
************************************************************
**)
.control
pre_osdi /home/vsduser/Desktop/asap_7nm_Xschem/bsimcmg.osdi
.endc



.subckt asap_7nm_nfet S G D B l=7e-009 nfin=14
	nnmos_finfet S G D B BSIMCMG_osdi_N l=7e-009 nfin=14
.ends asap_7nm_nfet

.model BSIMCMG_osdi_N BSIMCMG_va (
+ TYPE = 1
************************************************************
*                         general                          *
************************************************************
+version = 107             bulkmod = 1               igcmod  = 1               igbmod  = 0
+gidlmod = 1               iimod   = 0               geomod  = 1               rdsmod  = 0
+rgatemod= 0               rgeomod = 0               shmod   = 0               nqsmod  = 0
+coremod = 0               cgeomod = 0               capmod  = 0               tnom    = 25
+eot     = 1e-009          eotbox  = 1.4e-007        eotacc  = 1e-010          tfin    = 6.5e-009
+toxp    = 2.1e-009        nbody   = 1e+022          phig    = 4.2466          epsrox  = 3.9
+epsrsub = 11.9            easub   = 4.05            ni0sub  = 1.1e+016        bg0sub  = 1.17
+nc0sub  = 2.86e+025       nsd     = 2e+026          ngate   = 0               nseg    = 5
+l       = 2.1e-008        xl      = 1e-009          lint    = -2e-009         dlc     = 0
+dlbin   = 0               hfin    = 3.2e-008        deltaw  = 0               deltawcv= 0
+sdterm  = 0               epsrsp  = 3.9             nfin    = 1
+toxg    = 1.80e-009
************************************************************
*                            dc                            *
************************************************************
+cit     = 0               cdsc    = 0.01            cdscd   = 0.01            dvt0    = 0.05
+dvt1    = 0.47            phin    = 0.05            eta0    = 0.07            dsub    = 0.35
+k1rsce  = 0               lpe0    = 0               dvtshift= 0               qmfactor= 2.5
+etaqm   = 0.54            qm0     = 0.001           pqm     = 0.66            u0      = 0.0303
+etamob  = 2               up      = 0               ua      = 0.55            eu      = 1.2
+ud      = 0               ucs     = 1               rdswmin = 0               rdsw    = 200
+wr      = 1               rswmin  = 0               rdwmin  = 0               rshs    = 0
+rshd    = 0               vsat    = 70000           deltavsat= 0.2             ksativ  = 2
+mexp    = 4               ptwg    = 30              pclm    = 0.05            pclmg   = 0
+pdibl1  = 0               pdibl2  = 0.002           drout   = 1               pvag    = 0
+fpitch  = 2.7e-008        rth0    = 0.225           cth0    = 1.243e-006      wth0    = 2.6e-007
+lcdscd  = 5e-005          lcdscdr = 5e-005          lrdsw   = 0.2             lvsat   = 0
************************************************************
*                         leakage                          *
************************************************************
+aigc    = 0.014           bigc    = 0.005           cigc    = 0.25            dlcigs  = 1e-009
+dlcigd  = 1e-009          aigs    = 0.0115          aigd    = 0.0115          bigs    = 0.00332
+bigd    = 0.00332         cigs    = 0.35            cigd    = 0.35            poxedge = 1.1
+agidl   = 1e-012          agisl   = 1e-012          bgidl   = 10000000        bgisl   = 10000000
+egidl   = 0.35            egisl   = 0.35
************************************************************
*                            rf                            *
************************************************************
************************************************************
*                         junction                         *
************************************************************
************************************************************
*                       capacitance                        *
************************************************************
+cfs     = 0               cfd     = 0               cgso    = 1.6e-010        cgdo    = 1.6e-010
+cgsl    = 0               cgdl    = 0               ckappas = 0.6             ckappad = 0.6
+cgbo    = 0               cgbl    = 0
************************************************************
*                       temperature                        *
************************************************************
+tbgasub = 0.000473        tbgbsub = 636             kt1     = 0               kt1l    = 0
+ute     = -0.7            utl     = 0               ua1     = 0.001032        ud1     = 0
+ucste   = -0.004775       at      = 0.001           ptwgt   = 0.004           tmexp   = 0
+prt     = 0               tgidl   = -0.007          igt     = 2.5
************************************************************
*                          noise                           *
************************************************************
**)
.control
pre_osdi /home/vsduser/Desktop/asap_7nm_Xschem/bsimcmg.osdi
.endc


**** end user architecture code
.end
```



<img width="1852" height="754" alt="image" src="https://github.com/user-attachments/assets/6e882ada-bc30-4995-b6b0-beec963c0420" />

The following image shows the Vref value at different temperatures for 1v VDD supply.

<img width="357" height="619" alt="image" src="https://github.com/user-attachments/assets/8c637bfb-b84c-499e-8203-714f57c293bf" />

The image shows the Line Reg. (mV/V). To measure it we have used the following commands

```
.measure dc VREF_MAX MAX v(Vref)
.measure dc VREF_MIN MIN v(Vref)
.measure dc LINE_REG PARAM='(VREF_MAX - VREF_MIN)/(0.9-0.7)*1000
```




<img width="593" height="436" alt="image" src="https://github.com/user-attachments/assets/b312f2dc-1536-4aa5-b075-c4173a3da078" />


The following image shows the transient analysis and startup time waveform.

<img width="1041" height="479" alt="image" src="https://github.com/user-attachments/assets/d0f8decf-110f-4464-a342-c8bb31f30206" />

The image shows the results for different paramaters.

<img width="1034" height="228" alt="image" src="https://github.com/user-attachments/assets/342d870c-fa2a-4ef7-9408-91fc48cc8b62" />




